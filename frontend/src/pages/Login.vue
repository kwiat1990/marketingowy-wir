<template>
  <single-layout v-if="user">
    <p class="text-center">
      Cześć
      <span class="block text-2xl font-bold">{{ user }}</span>
    </p>

    <svg
      class="mx-auto my-12 max-h-96"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      viewBox="0 0 457.64 420.66"
    >
      <defs>
        <linearGradient
          id="a"
          x1="234.38"
          x2="216.33"
          y1="314.47"
          y2="875.17"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0" stop-color="#010101" stop-opacity="0" />
          <stop offset=".95" stop-color="#010101" />
        </linearGradient>
        <linearGradient id="c" x1="318.06" x2="253.99" y1="383.44" y2="186.72" xlink:href="#a" />
        <linearGradient id="d" x1="297.72" x2="214.7" y1="324.14" y2="331.96" xlink:href="#a" />
        <linearGradient
          id="b"
          x1="169.91"
          x2="362.56"
          y1="42.64"
          y2="24.89"
          gradientTransform="rotate(7.67 -362.18 470.6)"
          gradientUnits="userSpaceOnUse"
        >
          <stop offset="0" stop-color="#fff" stop-opacity="0" />
          <stop offset=".95" stop-color="#fff" />
        </linearGradient>
        <linearGradient id="e" x1="140.12" x2="307.7" y1="45.08" y2="29.64" xlink:href="#b" />
      </defs>
      <path
        fill="#68e1fd"
        d="M155.77 6.22c-22.17 9.15-37.39 29.83-48.69 51s-20 44-34.86 62.8c-10 12.67-22.44 23.17-33.06 35.31C7.73 191.22-6.15 241.79 2.55 288.7s39.78 89.14 82 111.38c48 25.3 105.86 24.36 158.87 12.84 29.77-6.47 59.43-16.11 89.87-14.9 10.19.41 20.62 2 30.43-.77 10.42-2.95 18.86-10.49 26.52-18.16 21.89-21.88 41-47 53.13-75.45 29.24-68.5 12.52-154.07-40.37-206.52-12.8-12.7-27.37-23.48-40.4-35.95-11.55-11-21.87-23.38-34.3-33.41C304.35 8.41 273.67-.52 243.14.95c-27.92 1.35-61.12-5.54-87.37 5.27z"
        opacity=".24"
        style="isolation: isolate"
      />
      <path
        fill="#68e1fd"
        d="M277.32 121.13c4.23-9.18 3.23-19.38 3.47-29.22a10.79 10.79 0 011-5.15c1.53-2.75 5.21-4.29 8.8-4.57a21.64 21.64 0 013.32 0 7.93 7.93 0 017.33 8c-.16 16.11-1.6 32.59-11.59 46.12-4.21 5.7-9.77 10.6-15.55 15.23-5.3 4.25-10.88 8.35-17.32 11.28a15.48 15.48 0 01-7.61 1.77 10.24 10.24 0 01-8.18-6c-1.61-3.49-3.35-12.66 0-15.8 2.6-2.44 9.47-4.91 13-5.93 10.6-3 19.28-6.95 23.33-15.73z"
      />
      <ellipse cx="232.11" cy="385.04" fill="url(#a)" opacity=".48" rx="89.64" ry="13.84" />
      <path
        fill="#c8a59c"
        d="M246.77 358.11l.35 7.65a10.22 10.22 0 01-6.83 6.28 9.9 9.9 0 01-8.6-1.76l.55-12.83M217.02 365.09l.35 7.66a10.22 10.22 0 01-6.83 6.28 9.89 9.89 0 01-8.6-1.77l.55-12.82"
      />
      <path
        fill="#606161"
        d="M252.83 232.64l-5.09 127.22a12 12 0 01-6.71 2.33c-4.7.27-5.55.61-8.93-2.47L217.32 226.3l35.51-.75z"
      />
      <path
        fill="url(#c)"
        d="M308.81 263.23l-5.09 127.22a12 12 0 01-6.71 2.33c-4.7.27-5.55.61-8.93-2.47L273.3 256.89l35.51-.75z"
        transform="translate(-55.98 -30.59)"
      />
      <path
        fill="#606161"
        d="M232.72 244.06L218.08 367.8s-2.12 2.17-7.86 2.24c-6.54.09-7.13-.8-8.59-4.11L198.76 224l33.61 5.73z"
      />
      <path
        fill="url(#d)"
        d="M288.7 274.65l-14.64 123.74s-2.12 2.17-7.86 2.24c-6.54.09-7.13-.8-8.59-4.11l-2.87-141.93 33.61 5.73z"
        transform="translate(-55.98 -30.59)"
      />
      <path
        fill="#f2fbff"
        d="M237.33 231.68a76.65 76.65 0 01-14.11 3.31c-6.36.65-13-2.42-18-2.68-6.66-.34-6.84-.55-6.84-4.89 0-2.19 55.32-7.42 55.32-7.42s-.26 4-.24 7.69c0 2.77-1.18 2.62-6.22 2.91s-6-1.19-9.91 1.08z"
      />
      <path
        fill="#68e1fd"
        d="M215.5 133.99s-9.28 2.41-15.9 7.23c-4.09 3-1.26 86.2-1.26 86.2.4-.07 18.18 7.14 35.37 4.18 14.64-2.53 19.92-9.4 19.92-9.4s1.32-79.85-1.52-83.13c-1.28-1.47-15.2-6.6-15.2-6.6s-6.08 9.13-21.41 1.52z"
      />
      <path
        fill="#c8a59c"
        d="M218.53 115.5l-3 18.49s6.8 10 15.39 8.47 6.46-5.5 6.46-5.5l-1.12-15.62s-7.79 1.37-17.73-5.84z"
      />
      <path
        fill="#b58b81"
        d="M217.47 122l1.06-6.5c9.94 7.21 15.09 4.15 15.09 4.15l2.4 8.39a8 8 0 01-5.11 2.45c-4.76.34-9.58-3.38-13.44-8.49z"
      />
      <path
        fill="#f2fbff"
        d="M236.74 134.34a26.39 26.39 0 01-3.44 7.57c.84.33 6.34 4.16 6.44 6.77 0 0 5.46-12.38 3.21-14.33a56.84 56.84 0 00-5.82-2.59zM217.27 134.34a13.38 13.38 0 006.86 7.2c-.84.33-9.76 4.53-9.86 7.14 0 0-5.47-12.38-3.21-14.33.6-.53 5.1-4.24 5.1-4.24z"
      />
      <path
        fill="#c8a59c"
        d="M210.75 102.04c.73 10.26 11.25 28.38 21.51 27.65s13.23-21.95 12.5-32.21-6.49-16.07-16.74-15.34a18.63 18.63 0 00-17.27 19.9z"
      />
      <path
        fill="#c8a59c"
        d="M236.86 119.09s-.29-.25-2.44-.09a32.3 32.3 0 01-7.62-.54c-1.65-.43-2.44-.17-2.28 2s1.92 4.2 6.26 4.43c4.88.26 6.93-1.58 7.31-3.77.28-1.54-.69-2.06-1.23-2.03z"
      />
      <path fill="#f2fbff" d="M250.94 162.02l-8.63 1.67-.42-2.66 8.64-1.68.41 2.67z" />
      <circle cx="226.76" cy="89.45" r="50.48" fill="#68e1fd" />
      <path
        fill="url(#b)"
        d="M332.75 126.77A50.47 50.47 0 11289.05 70h.41a50.46 50.46 0 0143.29 56.77z"
        transform="translate(-55.98 -30.59)"
      />
      <path
        fill="url(#e)"
        d="M332.75 126.77a50.47 50.47 0 01-43.18 43.29l-.41-.05A50.49 50.49 0 01289.05 70h.41a50.46 50.46 0 0143.29 56.77z"
        transform="translate(-55.98 -30.59)"
      />
      <circle cx="208.27" cy="81.31" r="4.96" fill="#68e1fd" />
      <circle cx="239.55" cy="81.31" r="4.96" fill="#68e1fd" />
      <path
        fill="#606161"
        d="M184.51 386.58c-1 1.18-1.91 2.6-1.17 3.86a5.25 5.25 0 003 1.85 30.62 30.62 0 0013.16.83 61.65 61.65 0 0012.52-3.35 13.15 13.15 0 003.25-1.53c1.95-1.4 2.45-3.52 2.69-5.5a35.44 35.44 0 000-8.17 1.87 1.87 0 00-1.24-1.81 3.86 3.86 0 00-1.84.14 61.81 61.81 0 01-10.41 1.58 13.28 13.28 0 00-4.6.93c-5.23 1.74-12.52 7.72-15.36 11.17zM231.67 382.63a3.41 3.41 0 00.88 2.24 6.7 6.7 0 002.93 1.2c9 2.14 18.45 4.06 27.76 2.91 2.08-.25 4.27-.72 5.6-1.9a3.92 3.92 0 00.61-5 16.35 16.35 0 00-4.28-4.26c-4-3.1-12.87-8.21-16.83-11.31a3.79 3.79 0 00-1.22-.72 5.37 5.37 0 00-2.08-.05c-3.64.41-2.39 3-6.07 3.09-1.71 0-4.38-.49-5.89.28-3.79 1.89-1.72 10.65-1.41 13.52z"
      />
      <path
        fill="#68e1fd"
        d="M181.02 160.89c-3.82 7.79-5.47 16.19-7.1 24.5l-8 40.64c-.66 3.38-1.32 6.88-.27 10.19a9.43 9.43 0 008.36 6.54 10.12 10.12 0 008.54-4.62c1.72-2.62 2.22-5.67 2.67-8.64 2-13.54 3.64-27.33 9.72-40 3.9-8.14 9.61-15.71 12.07-24.24 1.51-5.21 2.36-20.33-5.93-22.82-7.64-2.3-17.71 13.73-20.06 18.45z"
      />
      <path
        fill="#c8a59c"
        d="M181.68 246.32c-.79.17-1.38-.71-1.75-1.44s-1.06-1.57-1.82-1.28a1.38 1.38 0 00-.72.84 5.7 5.7 0 00-.28 2.25 19.35 19.35 0 001.16 6 11.69 11.69 0 01.89 3 2.81 2.81 0 01-1.22 2.73c-1.38.74-3-.37-4.06-1.52a25.35 25.35 0 01-6.54-19.59c.19-1.78.67-3.72 2.12-4.75a5.44 5.44 0 011.9-.81c10.49-2.67 11.96 6.03 10.32 14.57zM282.02 76.91a9.91 9.91 0 01-1.63-3.14 3.34 3.34 0 01.81-3.27 17.13 17.13 0 003.22 1.42 1.45 1.45 0 00.82.1c.87-.22.73-1.5.39-2.34l-2.76-6.71c-.68-1.66-1.35-3.63-.43-5.18a3.81 3.81 0 013.26-1.64 8.5 8.5 0 013.63 1 20.11 20.11 0 019 8.64 16.76 16.76 0 011.29 12.32 8.33 8.33 0 01-2.65 4.29 10.36 10.36 0 01-2.61 1.33c-2.44.92-5.57 2-7.74.09-1.89-1.62-3.25-4.87-4.6-6.91z"
      />
      <path
        fill="#68e1fd"
        d="M206.62 105.53l2.66-1.73c3.52 3.69 9.45 6.86 19.52 6.89h.12c7.79 0 13-2.72 16.45-6.12l2.21 2.21c-4 3.91-9.87 7.12-18.66 7.12h-.16c-11.5-.03-18.23-3.94-22.14-8.37z"
      />
    </svg>

    <g-link to="/" class="font-bold">
      <app-icon class="mr-2" icon="arrow-up" rotate="270" disableHover></app-icon>
      Wróć do strony głównej</g-link
    >
  </single-layout>
  <form v-else class="container max-w-xl" @submit.prevent="onSubmit">
    <div>
      <label for="email">E-mail</label>
      <div class="input-wrapper">
        <app-icon icon="email" disableHover></app-icon>
        <input type="email" id="email" v-model="email" />
      </div>
    </div>

    <div>
      <label for="name">Password</label>
      <div class="input-wrapper">
        <app-icon icon="lock" disableHover></app-icon>
        <input type="password" id="password" v-model="password" />
      </div>
    </div>

    <button type="submit" class="block w-full px-4 py-2 mx-auto button button--dark">Submit</button>
  </form>
</template>

<script>
import AppIcon from "~/components/Icon.vue";

export default {
  name: "Login",
  components: { AppIcon },
  data() {
    return {
      user: "",
      email: "",
      password: "",
    };
  },

  async mounted() {
    try {
      const res = await fetch(`${process.env.GRIDSOME_API_URL}/users/me`, {
        credentials: "include",
      });
      const data = await res.json();
      this.user = data?.username;
    } catch (e) {
      console.error("An error occured while fetching user: ", e);
    }
  },

  methods: {
    onSubmit() {
      try {
        fetch(`${process.env.GRIDSOME_API_URL}/auth/local`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify({ identifier: this.email, password: this.password }),
        })
          .then((res) => res.json())
          .then((data) => (this.user = data?.user?.username));
        this.email = "";
        this.password = "";
      } catch (e) {
        console.warn("There is an error occured.", e);
      }
    },
  },
};
</script>

<style lang="scss" scoped>
input {
  @apply pl-14;
}
</style>
